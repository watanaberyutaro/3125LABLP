// Generated by ClaudeCode - ãŠå•ã„åˆã‚ã›ãƒ¡ãƒ¼ãƒ«é€ä¿¡API
import { NextResponse } from 'next/server'
import nodemailer from 'nodemailer'

export async function POST(request: Request) {
  try {
    const body = await request.json()
    const { name, company, email, phone, subject, message } = body

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!name || !email || !subject || !message) {
      return NextResponse.json(
        { error: 'å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“' },
        { status: 400 }
      )
    }

    // é–‹ç™ºç’°å¢ƒãƒã‚§ãƒƒã‚¯ or SMTPè¨­å®šãŒæœªå®Œäº†ã®å ´åˆ
    const isDevelopment = process.env.NODE_ENV === 'development' ||
                         !process.env.SMTP_USER ||
                         !process.env.SMTP_PASS

    // é–‹ç™ºç’°å¢ƒã¾ãŸã¯SMTPæœªè¨­å®šã®å ´åˆã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—
    if (isDevelopment) {
      console.log('ğŸ“§ [é–‹ç™ºç’°å¢ƒ] ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å†…å®¹:')
      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
      console.log('ãŠåå‰:', name)
      console.log('ä¼šç¤¾å:', company || 'ï¼ˆæœªå…¥åŠ›ï¼‰')
      console.log('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:', email)
      console.log('é›»è©±ç•ªå·:', phone || 'ï¼ˆæœªå…¥åŠ›ï¼‰')
      console.log('ãŠå•ã„åˆã‚ã›ç¨®åˆ¥:', subject)
      console.log('ãŠå•ã„åˆã‚ã›å†…å®¹:', message)
      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')

      return NextResponse.json(
        { message: 'ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆé–‹ç™ºç’°å¢ƒï¼‰' },
        { status: 200 }
      )
    }

    // æœ¬ç•ªç’°å¢ƒç”¨: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®è¨­å®š
    const transporter = nodemailer.createTransport({
      host: process.env.SMTP_HOST || 'smtp.gmail.com',
      port: parseInt(process.env.SMTP_PORT || '587'),
      secure: false,
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS,
      },
    })

    // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã®ä½œæˆ
    const emailContent = `
ã€3125 LAB ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚Šã€‘

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãŠåå‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${name}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ä¼šç¤¾å
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${company || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${email}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  é›»è©±ç•ªå·
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${phone || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãŠå•ã„åˆã‚ã›ç¨®åˆ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${subject}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãŠå•ã„åˆã‚ã›å†…å®¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${message}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯3125 LABå…¬å¼ã‚µã‚¤ãƒˆã®ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚
    `

    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    await transporter.sendMail({
      from: process.env.SMTP_FROM || email,
      to: process.env.CONTACT_EMAIL || 'contact@example.com',
      subject: `ã€ãŠå•ã„åˆã‚ã›ã€‘${subject} - ${name}æ§˜`,
      text: emailContent,
      replyTo: email,
    })

    // è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ï¼ˆãŠå®¢æ§˜ã¸ï¼‰
    const autoReplyContent = `
${name} æ§˜

ã“ã®åº¦ã¯3125 LABã«ãŠå•ã„åˆã‚ã›ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ä»¥ä¸‹ã®å†…å®¹ã§ãŠå•ã„åˆã‚ã›ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚
æ‹…å½“è€…ã‚ˆã‚Š2å–¶æ¥­æ—¥ä»¥å†…ã«ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãŠå•ã„åˆã‚ã›ç¨®åˆ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${subject}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–  ãŠå•ã„åˆã‚ã›å†…å®¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${message}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»Šã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã¾ã›ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3125 LAB
Web: https://3125lab.jp
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®ãƒ¡ãƒ¼ãƒ«ã«è¿”ä¿¡ã„ãŸã ã„ã¦ã‚‚å¯¾å¿œã§ãã¾ã›ã‚“ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚
    `

    try {
      await transporter.sendMail({
        from: process.env.SMTP_FROM || process.env.CONTACT_EMAIL || 'noreply@example.com',
        to: email,
        subject: 'ã€3125 LABã€‘ãŠå•ã„åˆã‚ã›ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ',
        text: autoReplyContent,
      })
    } catch (autoReplyError) {
      console.error('è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼:', autoReplyError)
      // è‡ªå‹•è¿”ä¿¡ãŒå¤±æ•—ã—ã¦ã‚‚ã€ãƒ¡ã‚¤ãƒ³ã®é€ä¿¡ã¯æˆåŠŸã¨ã—ã¦æ‰±ã†
    }

    return NextResponse.json(
      { message: 'ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ' },
      { status: 200 }
    )
  } catch (error) {
    console.error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error)
    return NextResponse.json(
      { error: 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚' },
      { status: 500 }
    )
  }
}
